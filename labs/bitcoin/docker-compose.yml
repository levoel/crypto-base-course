# Crypto Fundamentals Lab - Bitcoin Environment
# Bitcoin Core in regtest mode for local development
# Verified: 2026-02-04

services:
  bitcoind:
    image: ruimarinho/bitcoin-core:28.0
    container_name: bitcoin-regtest
    command:
      - -regtest
      - -server
      - -rpcuser=crypto
      - -rpcpassword=crypto123
      - -rpcallowip=0.0.0.0/0
      - -rpcbind=0.0.0.0
      - -txindex=1
      - -fallbackfee=0.0001
      - -printtoconsole
    ports:
      - "18443:18443"  # RPC
      - "18444:18444"  # P2P
    volumes:
      - bitcoin-data:/home/bitcoin/.bitcoin
    healthcheck:
      test: ["CMD", "bitcoin-cli", "-regtest", "-rpcuser=crypto", "-rpcpassword=crypto123", "getblockchaininfo"]
      interval: 30s
      timeout: 10s
      retries: 5

  # Optional: Electrum server for lightweight clients
  electrs:
    image: getumbrel/electrs:v0.10.9
    container_name: bitcoin-electrs
    depends_on:
      bitcoind:
        condition: service_healthy
    environment:
      - ELECTRS_NETWORK=regtest
      - ELECTRS_DAEMON_RPC_ADDR=bitcoind:18443
      - ELECTRS_ELECTRUM_RPC_ADDR=0.0.0.0:50001
    ports:
      - "50001:50001"
    volumes:
      - electrs-data:/data

volumes:
  bitcoin-data:
  electrs-data:
