# Crypto Fundamentals Lab - Solana Environment
# Solana Test Validator for local development
# Verified: 2026-02-04

services:
  # Solana Test Validator
  validator:
    image: solanalabs/solana:v2.2.5
    container_name: solana-validator
    command: >
      solana-test-validator
      --reset
      --rpc-port 8899
      --faucet-port 9900
      --limit-ledger-size 50000000
    ports:
      - "8899:8899"   # RPC
      - "8900:8900"   # WebSocket
      - "9900:9900"   # Faucet
    volumes:
      - solana-ledger:/root/ledger
    healthcheck:
      test: ["CMD", "solana", "cluster-version", "-u", "http://localhost:8899"]
      interval: 30s
      timeout: 10s
      retries: 5
    environment:
      - RUST_LOG=solana_runtime::system_instruction_processor=trace

  # Anchor development environment
  anchor-dev:
    image: projectserum/build:v0.32.0
    container_name: solana-anchor
    depends_on:
      validator:
        condition: service_healthy
    volumes:
      - ./programs:/workspaces
    working_dir: /workspaces
    command: tail -f /dev/null
    environment:
      - ANCHOR_PROVIDER_URL=http://validator:8899
      - ANCHOR_WALLET=/root/.config/solana/id.json

volumes:
  solana-ledger:
